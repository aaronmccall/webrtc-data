!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.SimpleWebRTCData=e():"undefined"!=typeof global?global.SimpleWebRTCData=e():"undefined"!=typeof self&&(self.SimpleWebRTCData=e())}(function(){return function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return o(n?n:e)},p,p.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t){function n(e){var t=this,n=e||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"}]},peerConnectionContraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]}};var r;this.logger=function(){return e.debug?e.logger||console:e.logger||a}(),i.support||this.logger.error("Your browser doesn't seem to support WebRTC");for(r in n)n.hasOwnProperty(r)&&(this.config[r]=n[r]);this.peers=[],o.call(this),this.config.debug&&this.on("*",function(e,n,i){var o;o=t.config.logger===a?console:t.logger,o.log("event:",e,n,i)})}var i=e("webrtcsupport"),o=e("wildemitter"),r=e("./webrtc-peer"),a=e("mockconsole");n.prototype=Object.create(o.prototype,{constructor:{value:n}}),n.prototype.createPeer=function(e){var t;return e.parent=this,t=new r(e),this.peers.push(t),t},n.prototype.removePeers=function(e,t){this.getPeers(e,t).forEach(function(e){e.end()})},n.prototype.getPeers=function(e,t){return this.peers.filter(function(n){return!(e&&n.id!==e||t&&n.type!==t)})},n.prototype.sendToAll=function(e,t){this.peers.forEach(function(n){n.send(e,t)})},t.exports=n},{"./webrtc-peer":2,mockconsole:3,webrtcsupport:5,wildemitter:6}],2:[function(e,t){function n(e){var t=this;if(this.id=e.id,this.parent=e.parent,this.oneway=e.oneway||!1,this.browserPrefix=e.prefix,this.stream=e.stream,this.channels={},this.pc=new i(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionContraints),this.pc.on("ice",this.onIceCandidate.bind(this)),this.pc.on("addChannel",this.handleDataChannelAdded.bind(this)),this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded")),this.logger=this.parent.logger,webrtc.dataChannel){try{if(this.reliableChannel=this.getDataChannel("reliable",{reliable:!0}),!this.reliableChannel.reliable)throw Error("Failed to make reliable channel")}catch(n){this.logger.warn("Failed to create reliable data channel."),this.reliableChannel=!1,delete this.channels.reliable}try{if(this.unreliableChannel=this.getDataChannel("unreliable",{reliable:!1,preset:!0}),this.unreliableChannel.unreliable!==!1)throw Error("Failed to make unreliable channel")}catch(n){this.logger.warn("Failed to create unreliable data channel."),this.unreliableChannel=!1,delete this.channels.unreliableChannel}}o.call(this),this.on("*",function(){t.parent.emit.apply(t.parent,arguments)})}var i=e("rtcpeerconnection"),o=e("wildemitter");n.prototype=Object.create(o.prototype,{constructor:{value:n}}),n.prototype.handleMessage=function(e){var t=this;this.logger.log("getting",e.type,e),e.prefix&&(this.browserPrefix=e.prefix),"offer"===e.type?this.pc.answer(e.payload,function(e,n){t.send("answer",n)}):"answer"===e.type?this.pc.handleAnswer(e.payload):"candidate"===e.type?this.pc.processIce(e.payload):"data"===e.type&&this.parent.emit("data",e)},n.prototype.send=function(e,t){var n={to:this.id,roomType:this.type,type:e,payload:t,prefix:webrtc.prefix};this.logger.log("sending",e,n),this.parent.emit("message",n)},n.prototype._observeDataChannel=function(e){var t=this;e.onclose=this.emit.bind(this,"channelClose",e),e.onerror=this.emit.bind(this,"channelError",e),e.onmessage=function(n){t.emit("message",e.label,n.data,e,n)},e.onopen=this.emit.bind(this,"channelOpen",e)},n.prototype.getDataChannel=function(e,t){if(!webrtc.dataChannel)return this.emit("error",new Error("createDataChannel not supported"));var n=this.channels[e];return t||(t={}),n?n:(n=this.channels[e]=this.pc.createDataChannel(e,t),this._observeDataChannel(n),n)},n.prototype.onIceCandidate=function(e){this.closed||(e?this.send("candidate",e):this.logger.log("End of candidates."))},n.prototype.start=function(){var e=this;this.pc.offer(function(t,n){e.send("offer",n)})},n.prototype.end=function(){this.pc.close()},n.prototype.handleDataChannelAdded=function(e){this.channels[e.name]=e},t.exports=n},{rtcpeerconnection:4,wildemitter:6}],3:[function(e,t){for(var n="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),i=n.length,o=function(){},r={};i--;)r[n[i]]=o;t.exports=r},{}],4:[function(e,t){function n(e,t){var n;this.pc=new o.PeerConnection(e,t),i.call(this),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onaddstream=this._onAddStream.bind(this),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.config={debug:!1,sdpHack:!0};for(n in e)this.config[n]=e[n];this.config.debug&&this.on("*",function(){var t=e.logger||console;t.log("PeerConnection event:",arguments)})}var i=e("wildemitter"),o=e("webrtcsupport");n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.addStream=function(e){this.localStream=e,this.pc.addStream(e)},n.prototype.processIce=function(e){this.pc.addIceCandidate(new o.IceCandidate(e))},n.prototype.offer=function(e,t){var n=this,i=2===arguments.length,o=i?e:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},r=i?t:e;this.pc.createOffer(function(e){e.sdp=n._applySdpHack(e.sdp),n.pc.setLocalDescription(e),n.emit("offer",e),r&&r(null,e)},function(e){n.emit("error",e),r&&r(e)},o)},n.prototype.answerAudioOnly=function(e,t){var n={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};this._answer(e,n,t)},n.prototype.answerBroadcastOnly=function(e,t){var n={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this._answer(e,n,t)},n.prototype.answer=function(e,t,n){var i=3===arguments.length,o=i?n:t,r=i?t:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(e,r,o)},n.prototype.handleAnswer=function(e){this.pc.setRemoteDescription(new o.SessionDescription(e))},n.prototype.close=function(){this.pc.close(),this.emit("close")},n.prototype._answer=function(e,t,n){var i=this;this.pc.setRemoteDescription(new o.SessionDescription(e)),this.pc.createAnswer(function(e){e.sdp=i._applySdpHack(e.sdp),i.pc.setLocalDescription(e),i.emit("answer",e),n&&n(null,e)},function(e){i.emit("error",e),n&&n(e)},t)},n.prototype._onIce=function(e){e.candidate?this.emit("ice",e.candidate):this.emit("endOfCandidates")},n.prototype._onDataChannel=function(e){this.emit("addChannel",e.channel)},n.prototype._onAddStream=function(e){this.remoteStream=e.stream,this.emit("addStream",e)},n.prototype._applySdpHack=function(e){if(!this.config.sdpHack)return e;var t=e.split("b=AS:30");return 2===t.length?t[0]+"b=AS:102400"+t[1]:e},n.prototype.createDataChannel=function(e,t){t||(t={});var n,i,r=!!t.reliable,a=t.protocol||"text/plain",s=!(!t.negotiated&&!t.preset);return"moz"===o.prefix?(n=r?{protocol:a,preset:s,stream:e}:{},i=this.pc.createDataChannel(e,n),i.binaryType="blob"):(n=r?{reliable:!0}:{reliable:!1},i=this.pc.createDataChannel(e,n)),i},t.exports=n},{webrtcsupport:5,wildemitter:6}],5:[function(e,t){var n,i=!1,o=!1,r=navigator.userAgent.toLowerCase();-1!==r.indexOf("firefox")?(n="moz",o=!0):-1!==r.indexOf("chrome")&&(n="webkit",i=!0);var a=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,s=window.mozRTCIceCandidate||window.RTCIceCandidate,c=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,l=navigator.userAgent.match("Chrome")&&parseInt(navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26,h=window.webkitAudioContext||window.AudioContext;t.exports={support:!!a,dataChannel:i||o||a.prototype&&a.prototype.createDataChannel,prefix:n,webAudio:!(!h||!h.prototype.createMediaStreamSource),mediaStream:!(!p||!p.prototype.removeTrack),screenSharing:!!l,AudioContext:h,PeerConnection:a,SessionDescription:c,IceCandidate:s}},{}],6:[function(e,t){function n(){this.callbacks={}}t.exports=n,n.prototype.on=function(e){var t=3===arguments.length,n=t?arguments[1]:void 0,i=t?arguments[2]:arguments[1];return i._groupName=n,(this.callbacks[e]=this.callbacks[e]||[]).push(i),this},n.prototype.once=function(e){function t(){n.off(e,t),r.apply(this,arguments)}var n=this,i=3===arguments.length,o=i?arguments[1]:void 0,r=i?arguments[2]:arguments[1];return this.on(e,o,t),this},n.prototype.releaseGroup=function(e){var t,n,i,o;for(t in this.callbacks)for(o=this.callbacks[t],n=0,i=o.length;i>n;n++)o[n]._groupName===e&&(o.splice(n,1),n--,i--);return this},n.prototype.off=function(e,t){var n,i=this.callbacks[e];return i?1===arguments.length?(delete this.callbacks[e],this):(n=i.indexOf(t),i.splice(n,1),this):this},n.prototype.emit=function(e){var t,n,i=[].slice.call(arguments,1),o=this.callbacks[e],r=this.getWildcardCallbacks(e);if(o)for(t=0,n=o.length;n>t&&o[t];++t)o[t].apply(this,i);if(r)for(t=0,n=r.length;n>t&&r[t];++t)r[t].apply(this,[e].concat(i));return this},n.prototype.getWildcardCallbacks=function(e){var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[1].length)===n[1])&&(i=i.concat(this.callbacks[t]));return i}},{}]},{},[1])(1)});